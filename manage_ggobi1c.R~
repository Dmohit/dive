ggobi.manager <- function(frame,name='cepp')
  {
    require(rggobi)
    cols <- c('Purple','Pink','Red','Blue','Green','Orange','Brown','Grey','Yellow')
    g <- ggobi(frame,name=name)
    nc <- ncol(frame)
    xnames <- colnames(frame)[seq(1,nc,2)]
    ynames <- colnames(frame)[seq(2,nc,2)]
    for(i in 1:(nc/2))
      {
        d <- display(g[1],vars=list(X=xnames[i],Y=ynames[i]))
        imode(d) <- "Brush"
      }
    
    get.scatter.displays <- function()
      {
        l <- displays(g)[sapply(displays(g),FUN=function(x) class(x)[1] == "GGobiScatterplotDisplay")]
        return(l)
      }
    
    get.display.dataset <- function()
      {
        l <- get.scatter.displays()
        return(dataset(l[[1]]))
      }
    
    get.current.id <- function()
      {
        l <- get.scatter.displays()
        xname <- variables(l[[1]])$X
        yname <- variables(l[[1]])$Y
        return(c(xname,yname))
      }
    
    is.valid <- function(id)
    {
      l <- get.scatter.displays()
      xname <- variables(l[[1]])$X
      yname <- variables(l[[1]])$Y
      if(id[1] != xname | id[2] != yname) return(FALSE)
      else return(TRUE)
    }
    
    redraw <- function(id,var,values)
      {
        cur.id <- get.current.id()
        if(!(var %in% cur.id)) return(FALSE)
        else
          {
            d <- get.display.dataset()
            d[,var] <- values
            return(TRUE)
          }
      }
    
    get.color.group <- function(color)
      {
        colint <- which(color %in% cols)
        as.integer(which(glyph_color(g[1])== colint))
      }

    get.number.brushes <- function()
      {
        length(unique(glyph_color(g[1])))
      }

    get.brush.colors <- function()
      {
        cols[unique(glyph_color(g[1]))]
      }

    get.all.cols <- function()
      return(cols)
    
    return(list(get.display.dataset=get.display.dataset,get.all.cols=get.all.cols,
                get.current.id=get.current.id,
                redraw=redraw,
                get.number.brushes=get.number.brushes,get.brush.colors=get.brush.colors,get.color.group=get.color.group))
  }
